.TH _update 1W "2001.2.7" "WIN SYSTEM" "WIN SYSTEM"
.SH NAME
_update, _update1, _update2 - Database updating processing of event recording server
.SH SYNOPSIS
_update [ 
.I host ...
]
.LP
_update1 [ 
.I host ...
]
.LP
_update2
.SH DESCRIPTION
_update generates hypocenter database or recording and inspection status list (ee(1W) list) from trigger lists generated by pmon(1W), event waveform files generated by events(1W) and inspection information files generated by automatic inspection processing or interactive inspection processing by automan(1W) and autopick(1W) in the event recording server.
_update is generally executed from _bj(1W) periodically.
Only recording and inspection status list of the current month is generated by _update1. 
_update1 is generally executed from _bj1(1W) periodically. 
.LP
Works done by _update (_update1) are roughly divided into the following two:
.br
(1) to create hypocenter database from inspection information files.
.br
(2) to create event inspection status lists from trigger lists, inspection information files, etc. 
.LP
.IP (1)
Inspection information files or hypocenter information data are controlled by year and month expressed by "YYMM" form for each file or directory. Some of those are automatically processed and others are manually reprocessed. Therefore they are distinguished by adding keywords such as "auto" and "man" to a file or a directory. 
Firstly, _update compares time stamp of monthly directory of inspection information files /dat/picks/man/YYMM with that of monthly hypocenter database file in binary form /dat/finals/man/YYMM, and when the former is updated, generates the latter using pick2finalb(1W) from inspection information files existing in the former.
When
.I host ...
has been specified, the results are also transferred to the /dat/etc/"SEIS"/finals/man directory of these hosts by rcp,
where "SEIS" is a name (variable) defined in setting file win.conf and represents a sysyem name (for example "eri"). However, if transfer to each host was not finished within "TIMO" seconds defined by win.conf, the transfer is abandoned. 
These works are done for every directory (YYMM) under /dat/picks/man.
.LP
In the above works, when even one newly updated YYMM is found, hypocenter database file for all periods /dat/etc/final.man connecting all monthly hypocenter database file under 
/dat/finals/man are created, and further database files for SeisView with a name "SEIS"-YY is created from this under /dat/seis using finalb2seis(1W) by year.
When
.I host ...
has been specified, a file connecting all files under /dat/etc/"SEIS"/finals/man is created in /dat/etc/"SEIS"/etc/final.man by rsh also for these hosts. 
.LP
Above works are done for "auto" instead of "man" in a similar way. However, in case of "auto," transfer etc. to
.I host ...
are not performed. 
.IP (2)
When monthly trigger list /dat/etc/pmon.out.YYMM or monthly inspection information file directory /dat/picks/man/YYMM has been updated, event inspection status list /dat/etc/evtemp.YYMM is created by elist(1W) based on the contents. This is the case of  "man." In case of "auto," updating works for monthly inspection information file directory and event inspection status list are done as /dat/picks/auto/YYMM and  /dat/etc/evtempa.YYMM, respectively in a similar way. In addition, event information labeled with "NOISE" is hidden so as not to be written. 
.LP
Only event inspection status list of the current month is created by _update1 instead of _update.
As for the list of the current month, presence of event waveform file in /dat/trg and whether the system is under automatic inspection will be also investigated. In addition, when inspection information file labeled with "NOISE" is only one file in the event, event waveform file in /dat/trg will be deleted. 
.LP
_update2, created by adding functions of both _update and _update1 to simplify them, is generally initiated from _bj2(1W). _update2 performs processing for all years and months including the current month, but does not perform processing relating to "auto" (based on /dat/picks/auto/). Further, it does not transfer the results to other hosts by rcp. It does not also perform processing relating to "SEIS." 
.SH OPTIONS
.TP 
None.
.SH SOURCE
.TP
`_update'
.TP
`_update1'
.TP
`_update2'
.SH SEE ALSO 
pick2finalb(1W), finalb2seis(1W), elist(1W), pmon(1W),
_bj(1W), _bj1(1W), _bj2(1W)
