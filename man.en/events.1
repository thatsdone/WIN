'\" t
.TH events 1W "2001.1.22" "WIN SYSTEM" "WIN SYSTEM"
.SH NAME
events, eventsrtape - Cutting out event waveforms according to list
.SH SYNOPSIS
events
[ -x
.I area
]
.I paramfile
[
.I start
.I end
]
.br
eventsrtape [ \-f
.I device
] [ \-x 
.I area
]
.I paramfile
.I start
.I end
.SH DESCRIPTION
Events cuts out event files within a time range specified by
.I start
and
.I end
from win format continuous data on disk according to the content of the settings file
.I \ paramfile,
while eventsrtape does so from win format continuous data on tape.
.br
Sources from which events cuts data out are minute-by-minute files in the format generated by wdisk(1W).
Sources from which eventsrtape cuts data out is continuous recording tape in the format generated by wtape(1W).
.LP
The start and end of the time range are specified with
.I start
and
.I end,
respectively.
Each format shows the year, month, day, hour, and minute as yymmdd.HHMM.
Any event is cut out which contains an "on time" included both in a trigger list and in this range (This applies to any event containing a matched "yymmdd.HHMM").
Matching with "on time" is performed only for the "yymmdd.HHMM" part. Therefore, though it is OK to write down to "yymmdd.HHMMSS" instead, the "SS" part will simply be ignored.
When
.I start
and
.I end
are omitted, events starts in the indefinite mode and continue until signaled to stop. Note, however, that the first to be cut out is the next event to be added in the trigger list.
In an automatic processing system, events is normally executed in the background from _bj(1W) in the indefinite mode.
The manner of operation of
.LP
events/eventsrtape must be described in the settings file
.I paramfile.
In
.I paramfile,
each line contains one specified item, and its meaning depends on its position from the top. In any line other than the first, only the first item delimited by a space, tab or line feed is read while the subsequent part of the line is all processed as a comment. Any lines starting with "#" are bypassed as comments. The content of each line is as follows:
.IP
.ti -5n
Line 1: Name of a trigger list file. This file is in the pmon(1W) output format. Any lines in the file starting with a blank are bypassed.
.IP
.ti -5n
Line 2: Name of a directory of win formatted minute-by-minute files from which events cuts data out. Though not used by eventsrtape, this line is necessary.
.IP
.ti -5n
Line 3: Name of a directory to which the cut out event files are written. This directory is where waveform files named in the "yymmdd.HHMMSS" format and their accompanying channel table files (named after the corresponding waveform file names and suffixed with ".ch") are created.
.IP
.ti -5n
Line 4: Free space (MB) that must always be kept available for the directory to which the cut out files are written. The maximum total space (MB) available for the files in the directory can be specified using the delimiter ":." Then, both restrictions on space will be followed. Before writing a newly cut out single event file in, events deletes old files (named in the "yymmdd.HHMMSS" format) in the same directory in order of time until a free space of the size specified by this line becomes available.
.IP
.ti -5n
Line 5: Name of a directory where temporary working files are created.
Because no waveforms per se are written in, a space of 1 MB or so will suffice.
.IP
.ti -5n
Line 6: Specifies the number of seconds before the "on time" of the trigger list, from which to start cutting out.
.IP
.ti -5n
Line 7: Coefficient that specifies the extent of cutting out after the "off time" of the trigger file. The end of cutting out will be postponed until a post-"off time" by the length of time of the "off time"\-"on time" multiplied by the square root of the value specified by this line.
.IP
.ti -5n
Line 8: Name of a channel table file. This file contains observation point names from which channel numbers required for cutting out data are obtained. It is also used to create a channel table file accompanying a waveform file.
.IP
.ti -5n
Line 9: Name of a zone definition file. In this text file, each line defines one zone. Each line head contains a zone name that appears in the trigger list. Each zone name is followed on the right by one or more names of observation points belonging to that zone, each delimited by a blank or tab from the others. One observation point can belong to more than one zone. 
In the current version, however, the delimiters "+\-/," which can be used in zone definition files for pmon(1W), cannot be used. Use caution in combined use. Any "#" at any line head will be ignored.
.IP
.ti -5n
Line 10: Name of a file that defines "neighboring zones" of each zone.
When cutting out an event file, events/eventsrtape cuts out not only the data of the zones listed in the trigger list for that event, but also those of observation points belonging to the zones "neighboring" such zones. This file defines the locations of the neighboring zones of a zone. It is acceptable to define a zone as a "neighboring" zone when it actually is not.
In this text file, each line defines the neighboring zones of one zone. Each line head contains the name of one zone that appears in the trigger list or zone definition file. Each zone name is followed on the right by one or more names of observation points neighboring that zone, each delimited by a blank or tab from the others.
When wishing to define no neighboring zones for a zone, type in the name of that zone as its own neighboring zone where the names of the actual neighboring zones are supposed to be typed in.
.IP
.ti -5n
Line 11: This line specifies a directory in which, each time finishing cutting out an event file, events/eventsrtape creates a zero-size file named the same as the corresponding event waveform file. This mechanism notifies the automatic measurement program autopick(1W) or the automatic measurement allocation program automan(1W) that the event file has been created.
.LP
The subsequent lines contain the settings required for the system, according to which events requests the other networked continuous data servers for channel data missing from the continuous data directory specified by line 2.
.IP
.ti -5n
Line 12:
.IP
.ti -5n
Line 13:
.IP
.ti -5n
Line 14:
.IP
.ti -5n
Line 15 and on:
.LP
An example of setting file goes as follows:
.LP
.nf
/dat/etc/pmon.out      # trigger file 
/dat/raw               # input raw file directory 
/dat/trg               # output trg file directory 
100:1000               # min.free space and max.used amount in outdir (MB)
/dat/tmp               # working directory for temporary file 
20                     # pre event time in sec (<60) 
3.0                    # post event time factor; LEN=PRE+TRG+POST*sqrt(TRG) 
/dat/etc/channels.tbl  # master channel table file
/dat/etc/zones.tbl     # zone table file
/dat/etc/nxtzones.tbl  # list of neighboring zones
/dat/auto              # touch directory for auto-pick
/dat/request           # request touch directory
eri                    # my system code
/dat/log/request-lpr   # log file
#
# list of remote data servers follows.
# local (my) server may be included, but it will not be used.
#<sys>  <station list>          <printcap entry of data server>
tky     /dat/etc/tky.station    request-saemon
sso     /dat/etc/sso.station    request-sso-jc3
.fi
.LP
To cut out data, events uses wed(1W) while eventsrtape uses rtape(1W). eventsrtape is the link to events.
.SH OPTIONS
.TP
\-f
Events are cut out from continuous record data of the tape device specified by
.I tape_device.
If omitted, /dev/nrst0 will be assumed by default.
.TP
\-x
Any event contained in the trigger list and triggered first by the area name
.I area
will not be cut out.
This option can be used multiple times to specify as many events as required.
.SH SOURCE
.TP
`events.c'
.SH SEE ALSO
winformat(1W), pmon(1W), wtape(1W), rtape(1W), wed(1W), autopick(1W),
automan(1W)
