.TH recvt 1W "2015.12.28" "WIN SYSTEM" "WIN SYSTEM"
.UC 4
.SH 名称
lily - 傾斜計LILYからのUDP/IPパケットの受信
.SH 形式
.IP
.ti -7
lily
[
.I \-b 4|5|5f
] [
.I \-t
] [
.I \-e ch_base2
] [
.I \-g mcast_group
] [
.I \-i interface
] [
.I \-s itvl
]
.I port
.I ch_base
.I shmkey
.I shmsize
[
.I logfile
]
.LP
.SH 解説
lily は、自ホストの UDP ポート番号
.I \ port
に宛てて送られる傾斜計LILYからUDPパケット
を受信し、１秒１パケット(サンプリングレート1Hz)のWIN形式に変換してキー
.I \ shmkey
で与えられる共有メモリ・セグメントに（巡回的に）書き込みます。
LILY自体はシリアルインターフェースを持ち、テキスト形式で
.nf

$  -5.462,  26.241,  7.36,  9.99,03/12/00 07:10:06,11.85,N9613

.fi
のようなデータを出力しますが、lily が受信するのは、それを
シリアル／IP変換器(例えばMOXA NPort5110)でUDPパケットに変換したものです。
上の例では、出力の各項目は左から、傾斜X成分、傾斜Y成分、
磁気コンパス方位、温度、タイムスタンプ、電源電圧、機器番号です。
lily が想定するのは、後述する方法で毎秒このような行を出力するよう設定された
LILYからの出力です。
lilyは、１パケットに複数行が含まれていたり、１行が複数パケットに
分割されていた場合でも、正しく処理できるはずです。
WIN形式についてはwinformat(1W)を、
共有メモリ上のフォーマットについてはrecvt(1W)を参照してください。
WIN形式のチャネル番号は、X成分が
.I \ ch_base
、Y成分が
.I \ ch_base
+1 になります。傾斜X,Y成分の単位はナノラジアンです。
キー
.I \ shmkey
をもつ共有メモリ・セグメントが存在しない場合は、大きさ
.I \ shmsize
\ (KB) の共有メモリ・セグメントが作られます。すでに存在している場合は、
そのサイズが
.I \ shmsize
\ (KB) よりも小さいとエラーになります。
UDP ポート番号は16ビットの整数値、共有メモリ・キーは32ビットの
整数値です。
.LP
ログファイル名
.I \ logfile
を指定すると、ここに動作ログがとられ、
指定しないとログ情報は標準出力に
送られます。ログファイルは書き込みのたび毎に
オープン／クローズされます。
.LP
lily は引数なしで起動すると簡単な使用法を表示します。
.SH オプション
.IP "\fB\-b \fImode" 5
書き込みデータのサンプルサイズが
.I 4 バイト
の場合のサンプルサイズ情報のモードを指定します。
.nf
4 : サンプルサイズ情報を 4 にします。
5 : サンプルサイズ情報を 5 にします。
5f : サンプルサイズが 4 バイト長以外についてもサンプルサイズ情報を 5
     にします。つまり、常に圧縮の無い固定長データとなります。
.IP \fB\-t 5
WIN形式のタイムスタンプを付ける際に、LILYから送られて来る
データに付けられたタイムスタンプを使います。デフォルトでは
lilyを実行するホストのシステム時計が使われます。
.IP "\fB\-e \fIch_base2" 5
出力を磁気コンパス方位と温度も含めた拡張形式とし、
それらのチャネル番号をそれぞれ、
.I \ ch_base2
と
.I \ ch_base2
+1 とします。磁気コンパス方位の単位は0.01度(磁北が0で右回りに
１周が36000)、温度の単位は0.01℃(摂氏温度を100倍したもの)です。
.IP "\fB\-g \fIgroup" 5
IPマルチキャストアドレス
.I group
に対して送信されるパケットを受信します。
.IP "\fB\-i \fIinterface" 5
パケットを受信するネットワークインターフェースを、そのインターフェースの
IPアドレス
.I interface
で指定します。
.IP "\fB\-s \fIitvl" 5
.I \ itvl
ログファイルにLILYからの生のテキストデータを書き込む間隔を、
分単位で指定します。デフォルトは 0 で、その場合は
起動時に一度だけ、生データがログファイルに書き込まれます。
.SH LILYの初期設定方法
LAN経由で設定する場合は、LILYとの通信に
wxtrecv(1W) と wxtsend(1W) を利用することができます。
.nf
(1)Advenced Memory Modeに入る
    *9900XY-TOGGLE-AMEM
       ←このコマンドで
           - Advanced memory logging ON
           - Supply Voltage ON
           - Timestamp ON
         も設定される。
(2)電源OFF/ON後も内部データが残るようにする
    *9900XY-TOGGLE-AUTO-RECOVERY
(3)メモリを消去し蓄積を開始(伝送のみする場合は必要なし。)
    *9900XY-MEMS
(4)計測開始（毎秒出力）
    *9900XYC-OFF
    *9900XYC2
.fi
.SH ソース
.TP
`lily.c'
.SH 関連事項
winformat(1W), recvt(1W), wxtrecv(1W), wxtsend(1W)
