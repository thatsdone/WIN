'\" t
.TH raw_mon 1W "2000.12.21" "WIN SYSTEM" "WIN SYSTEM"
.SH 名称
raw_mon, raw_mond - RAW 形式データから MON 形式データへの変換
.SH 形式
raw_mon
.I rawkey
.I monkey
.I shmsize
[
.I chfile
[
.I logfile
]]
.LP
raw_mond
.I rawkey
.I monkey
.I shmsize
[
.I chfile
[
.I logfile
]]
.LP
.SH 解説
raw_mon は、キー
.I \ rawkey
の共有メモリ・セグメントに巡回的に書き込まれている、時間順に
整列された win フォーマットの RAW 形式
データから MON 形式データを生成し、キー
.I \ monkey
で与えられる共有メモリ・セグメントに書き込みます。
チャネルファイル
.I \ chfile
が与えられた場合は、その中にリストされたチャネルのデータだけが
書き出されます。ただしチャネルファイル名の先頭に '\-' を付けたときは、
そのファイルにリストされた以外の全チャネルのデータが書き出されます。
.I chfile
が与えられないか、または '\-' である場合は、
全チャネルが書き出されます。
キー
.I \ monkey
をもつ共有メモリ・セグメントが存在しない場合は、大きさ
.I \ shmsize
\ (KB) の共有メモリ・セグメントが作られます。すでに存在している場合は、
そのサイズが
.I \ shmsize
\ (KB) よりも小さいとエラーになります。
共有メモリ・キーは32ビットの整数値です。
.LP
raw_mond は daemon モードで起動します。
.LP
ログファイル名
.I \ logfile
を指定すると、ここに動作ログがとられます。
指定しないとログ情報は標準出力に送られます(ただし、daemon モードで動い
ている時は syslogd(8) に送られます)。ログファイルは書き込みのたび毎に
オープン／クローズされます。
.LP
raw_mon は、引数なしで起動すると簡単な使用法を表示します。
.LP
チャネルファイルは、１行に１つずつ、16進数でチャネル番号を
書き並べたテキストファイルです。各行の先頭の項目だけが読まれ、
空白またはタブで区切られた以降の項目は無視されます。また先頭
が '#' である行も無視されます。raw_mon プロセスは
ハングアップシグナルを受け取ると、チャネルファイルを読み直します。
.LP
共有メモリ上の形式については order(1W) と winformat(1W) を参照してください。
.LP
MON 形式は、0.2秒ごとの各区間での最大値と最小値だけを保存する、
非可逆の圧縮データ形式です。通常の win フォーマット（RAW 形式）
と比べると、秒ブロックが時刻ヘッダー（秒ヘッダー）とチャネル数分の
チャネルブロックからなるところまでは同じですが、
チャネルブロックの内部構造が異なります。1チャネル・1秒分のデータから
なるチャネルブロックは、次の形式です。

.ne 5
.TS
|c|c|c|c|c|
|c|c|c|c|c|
|c|c|c|c|c|
c s s s s.
_
チャネル番号	第1区間の	第2区間の		第5区間の
	最大最小値	最大最小値	...	最大最小値
2B	可変長	可変長		可変長
_
チャネルブロック（可変長）
.TE

.LP
先頭の２バイトはチャネル番号で、その後には0.2秒区間の最小値と
最大値がエンコードされた可変長(1〜7バイト)のブロックが、5区間分
(1秒分)続きます。１つの0.2秒区間の最小値と最大値は、次の形式で
エンコードされています。図中で二重の縦線はバイト境界の意味です。
１バイト内のビットの並びは、左が上位ビットです。複数バイト長の
値の表現はビッグエンディアン(上位バイトが先)で、負の値は２の補数表示です。

(1)最小値と最大値の両方が、7 bits で表現できるとき、
.ne 5
.TS
||c|c|c||c|c||
||c|c|c||c|c||
||c|c|c||c|c||
c s s s s.
_
最小値の	最大値の	値	最小値の	最大値の
上位3bit	上位3bit	00	下位4bit	下位4bit
3 b	3 b	2 b	4 b	4 b
_
１つの0.2秒区間の最大最小値（2 B）
.TE

(2)最小値と最大値の両方が、11 bits で表現できるとき、
.ne 5
.TS
||c|c|c||c||c||
||c|c|c||c||c||
||c|c|c||c||c||
c s s s s.
_
最小値の	最大値の	値	最小値の	最大値の
上位3bit	上位3bit	01	下位1B	下位1B
3 b	3 b	2 b	1 B	1 B
_
１つの0.2秒区間の最大最小値（3 B）
.TE

(3)最小値と最大値の両方が、19 bits で表現できるとき、
.ne 5
.TS
||c|c|c||c||c||
||c|c|c||c||c||
||c|c|c||c||c||
c s s s s.
_
最小値の	最大値の	値	最小値の	最大値の
上位3bit	上位3bit	10	下位2B	下位2B
3 b	3 b	2 b	2 B	2 B
_
１つの0.2秒区間の最大最小値（5 B）
.TE

(4)最小値と最大値の両方が、27 bits で表現できるとき、
.ne 5
.TS
||c|c|c||c||c||
||c|c|c||c||c||
||c|c|c||c||c||
c s s s s.
_
最小値の	最大値の	値	最小値の	最大値の
上位3bit	上位3bit	11	下位3B	下位3B
3 b	3 b	2 b	3 B	3 B
_
１つの0.2秒区間の最大最小値（7 B）
.TE

.SH オプション
.TP 
なし
.SH ソース
.TP
`raw_mon.c'
.SH 関連事項
winformat(1W), order(1W), raw2mon(1W)
