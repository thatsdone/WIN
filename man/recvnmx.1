.TH recvt 1W "2002.3.24" "WIN SYSTEM" "WIN SYSTEM"
.UC 4
.SH 名称
recvnmx - Nanometrics UDP/IPパケットの受信
.SH 形式
.IP
.ti -7
renvnmx
[
.I \-c map
] [
.I \-i interface
] [
.I \-m group
] [
.I \-vB
]
.I port
.I shmkey
.I shmsize
[
.I logfile
]
.LP
.SH 解説
recvnmx は、自ホストの UDP ポート番号
.I \ port
に宛てて送られるNanometrics形式の
データ(NMXPパケット)を受信し、WIN形式に変換してキー
.I \ shmkey
で与えられる共有メモリ・セグメントに（巡回的に）書き込みます。
現在のところ recvnmx は Compressed Data Packet のみを処理します。
WIN形式についてはwinformat(1W)を、
共有メモリ上のフォーマットについてはrecvt(1W)を参照してください。
WIN形式の16ビットのチャネル番号は、NMXPパケット中に書かれている
Nanometrics機器のシリアル番号とチャネル番号のペアから生成されます
(16ビットのうち上位11ビットがシリアル番号を下位5ビットがチャネル番号)。
WIN形式のチャネル番号を任意にマッピングしたい場合はオプション
\fB\-c\fP を使ってください。
キー
.I \ shmkey
をもつ共有メモリ・セグメントが存在しない場合は、大きさ
.I \ shmsize
\ (KB) の共有メモリ・セグメントが作られます。すでに存在している場合は、
そのサイズが
.I \ shmsize
\ (KB) よりも小さいとエラーになります。
UDP ポート番号は16ビットの整数値、共有メモリ・キーは32ビットの
整数値です。
.LP
ログファイル名
.I \ logfile
を指定すると、ここに動作ログがとられ、
指定しないとログ情報は標準出力に
送られます。ログファイルは書き込みのたび毎に
オープン／クローズされます。
.LP
recvnmx は引数なしで起動すると簡単な使用法を表示します。
.SH オプション
.IP \fB\-B 5
共有メモリの形式を後方サーチ可能な形式にします。この形式については
recvt(1W) のオプション \fB\-B\fR を参照してください。
.IP "\fB\-c \fImap" 5
ファイル
.I map
でWIN形式のチャネル番号の付け方を指定します。
.I map
のフォーマットは、1行で1台分ずつ、先頭に各Nanometrics機器の
シリアル番号を10進数で、その右に空白またはタブで区切ってWIN形式での
先頭チャネル番号を16進数で、それぞれ書いたものです。'#'で始まる行は
コメントとみなされます。各行で先頭から2項目だけが読まれ、それより
右は無視されます。Nanometrics機器が複数のチャネルをもつ場合、指定した
WIN形式の先頭チャネル番号から始まるチャネル数だけのチャネル番号が
割り当てられます。次の例ではシリアル番号#139の機器のチャネル1〜3に
それぞれ 0380,0381,0382 のチャネル番号が振られ、同様にして#141,#142,
#143にそれぞれ 0383〜0385,0386〜038B,038C〜0391が割り振られます。
.nf
   139 0380  # 3ch
   141 0383  # 3ch
   142 0386  # 6ch
   143 038C  # 6ch
.fi
recvnmx は HUPシグナルを受けると、ファイル
.I map
を読み直します。
.IP "\fB\-i \fIinterface" 5
IPマルチキャストアドレスに対して送信されるパケットを受信する場合に、
パケットを受信するネットワークインターフェースを、そのインターフェースの
IPアドレス
.I interface
で指定します。
.IP "\fB\-m \fIgroup" 5
IPマルチキャストアドレス
.I group
に対して送信されるパケットを受信します。
.IP \fB\-v 5
受信したNMXPパケットの情報を表示します。これはデバッグ用です。
.SH 実行例
次の例ではマルチキャストアドレス 224.0.1.1 のUDPポート 32000番へ
送られたNMXPパケットを IPアドレス 10.0.0.100 のネットワーク
インターフェースから受信し、共有メモリ 1001番(サイズ 1000KB)に
書き出します。ログファイルは /dat/log/recvnmx.log です。
.br
.IP
.ti -7
recvnmx -i 10.0.0.100 -m 224.0.1.1 -c recvnmx.prm 32000 1001 1000
/dat/log/recvnmx.log
.SH
タイムスタンプについて
recvnmx は NMXPパケットのタイムスタンプ(1970年1月1日00:00:00 UTCからの
秒数)をWIN形式のタイムスタンプ(JSTの年月日時分秒)に変換するのに
localtime(3)関数を使っています。その際に通常は閏秒が考慮されませんが、
Nanometrics機器のNMXPパケットのタイムスタンプでも閏秒は考慮されていない
(無視されている)ようなので、とりあえず問題ありません。
.SH ソース
.TP
`recvnmx.c'
.SH 関連事項
winformat(1W), recvt(1W)
