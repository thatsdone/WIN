.TH shmdump 1W "2014.11.12" "WIN SYSTEM" "WIN SYSTEM"
.SH 名称
shmdump - 共有メモリ・セグメント上のデータのモニタ
.SH 形式
shmdump [\-\fBamoqrtwxz\fR] [\-\fBs\fI\ sec\fR] [\-\fBf\fI\ file\fR]
.I shmkey/\-
[
.I ch ...
]
.SH 解説
shmdump は、キー
.I \ shmkey
で与えられる共有メモリ・セグメントに巡回的に書き込まれている
データの、各ブロックの最初の部分を読んでダンプしていきます。
.I \ shmkey
として "\-" を指定すると、共有メモリのかわりに標準入力から
データが読み込まれます。
チャネルのリスト
.I ch\ ...
を指定すると、指定されたチャネルはすべて、１行１チャネルの形式で
ダンプされます。
shmdump は共有メモリ上のブロック形式として、「書き込み時刻」付きの
もの（recvt(1W)参照）および「書き込み時刻」無しのもの
（order(1W)参照）のどちらでも、自動的に判別して読むことができます。
表示形式は以下のとおりです。
.SH 「書き込み時刻」無しの場合
まずブロックサイズ（バイト）、次にタイムスタンプの時刻（年〜秒）を12桁で、
次に最初のチャネルブロックの先頭８バイトを16進数で表示します。
.SH 「書き込み時刻」付きの場合
まずブロックサイズ（バイト）、続いて「書き込み時刻(RT=RealTime)」を年〜秒の
12桁で、その後にそれとタイムスタンプの時刻(TS=TimeStamp)との差
(RT-TS)を秒単位で表示し、次にタイムスタンプの時刻(TS)を年〜秒の12桁で、
次に最初のチャネルブロックの先頭８バイトを16進数で表示します。
.LP
上のいずれの場合でも、特定のチャネルを指定しないときは、
１ブロック（１秒分）の情報が１行に表示されますが、
チャネルのリストを指定したときは、１つの秒ブロックに複数のチャネルが入って
いても、先頭のタイムスタンプが各行にコピーされて出力されます。
.SH オプション
.IP "\fB\-a" 5
すべてのチャネルについてダンプします。なおこのオプションを指定した場合、
\fB\-{L,H,B}\fPオプションが無効になってしまいますので注意してください。
.IP "\fB\-f \fIfile" 5
チャネルのリストをファイル
.I file
から読み込みます。ファイル名の代わりに
"\-" を指定すると、標準入力から読み込みます。
リストは、空白、タブまたは改行で区切られた、16進数のチャネル番号です。
チャネルリストを標準入力から与えることと、データを標準入力から与えることは、
順序としてこの順番に読み込まれるので、両方同時に設定してもうまく行く場合が
あるかもしれませんが、あまりお勧めしません。
.br
なお，\fB\-r\fPオプションまたは\fB\-x\fPオプションが指定されたとき，
.I file
は出力ファイルを指定するのに使用することができます．
このとき，
.I file
は書き込みのたびにオープン／クローズされますので外部のプログラムによる
ファイルのローテーション等が可能です．
.IP "\fB\-m" 5
MON形式のデータを扱います。データがMON形式のときはこれを
指定しなければなりません。MON形式については raw_mon(1W)を
参照してください。
.IP "\fB\-o" 5
指定されたチャネル(\fB\-a\fPオプションが指定されたときは全チャネル)
のデータをWIN形式のまま、標準出力に書き出します。
このとき、通常の(１行１チャネルの)ダンプ出力は標準エラー出力に
書き出されます。
.IP "\fB\-q" 5
１行１チャネルの形式のダンプ出力を抑制します。ふつうは\fB\-o\fPオプション
または\fB\-t\fPオプションとともに指定されます。
.IP "\fB\-r" 5
無変換で標準出力に書き出します。
このとき、通常の(１行１チャネルの)ダンプ出力は標準エラー出力に
書き出されます。このオプションを指定した場合は、\fB\-f\fR、\fB\-q\fR、
\fB\-s\fR 以外のすべてのオプションは無効になります。
.IP "\fB\-s \fIsec" 5
.I sec
秒間実行後、終了します。ふつうはこれで約
.I sec
秒分のデータがダンプされる
ことになります。これを指定しない場合は、shmdumpは割り込みがあるまで
止まりません。
.IP "\fB\-t" 5
指定されたチャネル(\fB\-a\fPオプションが指定されたときは全チャネル)
のデータをテキスト形式に変換して、標準出力に書き出します。
このとき、通常の(１行１チャネルの)ダンプ出力は標準エラー出力に
書き出されます。１秒分の形式は次の通りです。秒ヘッダー行に続いて、
１行に１チャネル×１秒分のデータが空白で区切って出力されます。
.IP
.nf
年 月 日 時 分 秒　実チャネル数<new-line>
チャネル番号 サンプリングレート データ データ ....<new-line>
チャネル番号 サンプリングレート データ データ ....<new-line>
...(チャネル数分繰り返し)
.fi
.IP "\fB\-w" 5
指定されたチャネル(\fB\-a\fPオプションが指定されたときは全チャネル)
のデータをWIN形式のまま一時ファイルに書き出し、続いてwin(1W)を起動します。
一時ファイルが作られるのは、環境変数 TMP に設定されたディレクトリ、それが
なければ 環境変数 TEMP に設定されたディレクトリ、それもなければカレント
ディレクトリです。このオプションは \fB\-o\fPオプションを含みます。
.IP "\fB\-x" 5
無変換(ただし16進数表示)で標準出力に書き出します。このとき１パケットが
１行になります．
このとき、通常の(１行１チャネルの)ダンプ出力は標準エラー出力に
書き出されます。このオプションを指定した場合は、\fB\-f\fR、\fB\-q\fR、
\fB\-s\fR 以外のすべてのオプションは無効になります。
.IP "\fB\-z" 5
データを共有メモリセグメントの先頭から読み出します。これが指定されないと、
データは最新の書き込み部分から(それの書き込みが終るのを待って)読み出されます。
.IP "\fB\-{L,H,B}" 5
-tq を指定した場合の出力データにコマンドラインで指定したフィルターの特性で
フィルターをかけます。フィルターの係数の決定には、
.RS
.IP
斉藤正徳,1978,漸化式ディジタル・フィルターの自動設計,物理探鉱,31, 112-135
.RE
.IP
のプログラムを使用しています。設定パラメタの選び方についてはこの
文献を参照してください。
.IP "\fB\-L fp:fs:ap:as" 5
-tq を指定した場合の出力データにローパスをかけます。
.IP "\fB\-H fp:fs:ap:as" 5
-tq を指定した場合の出力データにハイパスをかけます。
.IP "\fB\-B fl:fh:fs:ap:as" 5
-tq を指定した場合の出力データにバンドパスをかけます。
.IP "\fB\-R rate" 5
-tq を指定した場合の出力データをrateでリサンプリングします。
.SH 使用例
.nf
shmdump 11 0200
  チャネル0200だけを(あれば必ず)リストする

shmdump 11 0200 0201 0202
  チャネル0200,0201,0202を(あれば必ず)リストする

echo 0200 0201 0202 | shmdump -f - 11
  上と同じ。チャネルのリストを標準入力から与える

shmdump -f aso.ch 11
  チャネルファイル aso.ch にあるチャネルを(あれば必ず)リストする

shmdump -of aso.ch 11 > aso.dat
  チャネルファイル aso.ch にあるチャネルの波形を aso.datに出力

shmdump -of aso.ch -s 10 11 > aso.dat
  チャネルファイル aso.ch にあるチャネルの波形を約10秒分 aso.datに出力

shmdump -wf aso.ch -s 10 11
  チャネルファイル aso.ch にあるチャネルの波形を約10秒分winで表示

grep -w HIT /dat/etc/channels.tbl|shmdump -ws 10 -f - 11
  観測点 HIT の波形を約10秒分winで表示

cat 041222.1717|shmdump -tq - 0252
  ディスクファイル041222.1717からチャネル0252をテキスト形式で出力
.fi
.SH ソース
.TP
`shmdump.c'
.SH 関連事項
winformat(1W), recvt(1W), order(1W), win(1W), raw_mon(1W)
