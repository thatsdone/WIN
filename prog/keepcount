#!/bin/sh
#
# $Id: keepcount,v 1.1.4.1 2010/12/28 12:55:40 uehira Exp $
# keepcount
#
dir=$1
if [ -z $dir ]
then
  echo usage : keepcount [directory]
  exit
fi
cd $dir
while true
do
  max=`cat MAX`
  if [ -n "$max" ]
  then
    ls|grep '^[0-9]'|sort -r |cat -n |
    while read no file
    do
      if [ $no -gt $max ]
      then
        rm $file
      fi
      if [ $no -eq $max ]
      then
        echo $file > OLDEST
      fi
    done
  fi
  sleep 300
done
